// Generated by DDC, the Dart Development Compiler (to JavaScript).
// Version: 3.3.1 (stable) (Wed Mar 6 13:09:19 2024 +0000) on "macos_arm64"
// Module: packages/leak_tracker/src/leak_tracking/helpers.dart
// Flags: newRuntimeTypes(true), soundNullSafety(true), enableAsserts(true)
define(['dart_sdk', 'packages/leak_tracker/src/leak_tracking/primitives/_retaining_path/_connection.dart', 'packages/leak_tracker/src/leak_tracking/primitives/_retaining_path/_retaining_path.dart', 'packages/leak_tracker/src/shared/_formatting.dart'], (function load__packages__leak_tracker__src__leak_tracking__helpers_dart(dart_sdk, packages__leak_tracker__src__leak_tracking__primitives___retaining_path___connection$46dart, packages__leak_tracker__src__leak_tracking__primitives___retaining_path___retaining_path$46dart, packages__leak_tracker__src__shared___formatting$46dart) {
  'use strict';
  const dart_rti = dart_sdk.dart_rti;
  const core = dart_sdk.core;
  const developer = dart_sdk.developer;
  const _interceptors = dart_sdk._interceptors;
  const async = dart_sdk.async;
  const dart = dart_sdk.dart;
  const dartx = dart_sdk.dartx;
  const _connection = packages__leak_tracker__src__leak_tracking__primitives___retaining_path___connection$46dart.src__leak_tracking__primitives___retaining_path___connection;
  const _retaining_path = packages__leak_tracker__src__leak_tracking__primitives___retaining_path___retaining_path$46dart.src__leak_tracking__primitives___retaining_path___retaining_path;
  const _formatting = packages__leak_tracker__src__shared___formatting$46dart.src__shared___formatting;
  var helpers = Object.create(dart.library);
  var $add = dartx.add;
  var $length = dartx.length;
  var $removeAt = dartx.removeAt;
  dart._checkModuleNullSafetyMode(true);
  dart._checkModuleRuntimeTypes(true);
  var T = {
    ListOfint: () => (T.ListOfint = dart.constFn(dart_rti.findType("core|List<core|int>")))(),
    int: () => (T.int = dart.constFn(dart_rti.findType("core|int")))(),
    intToint: () => (T.intToint = dart.constFn(dart_rti.findType("core|int(core|int)")))(),
    VoidTovoid: () => (T.VoidTovoid = dart.constFn(dart_rti.findType("~()")))(),
    void: () => (T.void = dart.constFn(dart_rti.findType("~")))(),
    StringN: () => (T.StringN = dart.constFn(dart_rti.findType("core|String?")))()
  };
  var G = {
    JSArrayOfListOfint: () => (G.JSArrayOfListOfint = dart.constFn(_interceptors.JSArray$(T.ListOfint())))(),
    ListOfint: () => (G.ListOfint = dart.constFn(core.List$(T.int())))(),
    FutureOfvoid: () => (G.FutureOfvoid = dart.constFn(async.Future$(T.void())))()
  };
  const CT = Object.create({
    _: () => (C, CT)
  });
  helpers.forceGC = function forceGC(opts) {
    let timeout = opts && 'timeout' in opts ? opts.timeout : null;
    let fullGcCycles = opts && 'fullGcCycles' in opts ? opts.fullGcCycles : 1;
    return async.async(T.void(), function* forceGC() {
      let t$360, t$360$, t$360$0, t$360$1;
      let stopwatch = timeout == null ? null : (t$360 = new core.Stopwatch.new(), (() => {
        t$360.start();
        return t$360;
      })());
      let barrier = developer.reachabilityBarrier;
      let storage = G.JSArrayOfListOfint().of([]);
      function allocateMemory() {
        storage[$add](G.ListOfint().generate(30000, dart.fn(n => n, T.intToint())));
        if (storage[$length] > 100) {
          storage[$removeAt](0);
        }
      }
      dart.fn(allocateMemory, T.VoidTovoid());
      while (developer.reachabilityBarrier < barrier + fullGcCycles) {
        if ((t$360$0 = (t$360$ = stopwatch, t$360$ == null ? null : t$360$.elapsed), t$360$0 == null ? core.Duration.zero : t$360$0)['>']((t$360$1 = timeout, t$360$1 == null ? core.Duration.zero : t$360$1))) {
          dart.throw(new async.TimeoutException.new("forceGC timed out", timeout));
        }
        yield G.FutureOfvoid().delayed(core.Duration.zero);
        allocateMemory();
      }
    });
  };
  helpers.formattedRetainingPath = function formattedRetainingPath(ref) {
    return async.async(T.StringN(), function* formattedRetainingPath() {
      if (ref.target == null) return null;
      let connection = (yield _connection.connect());
      let path = (yield _retaining_path.retainingPath(connection, ref.target));
      if (path == null) return null;
      return _formatting.retainingPathToString(path);
    });
  };
  dart_rti._Universe.addRules(dart.typeUniverse, JSON.parse('{"core|List":{"List.E":"1","Iterable.E":"1","core|Iterable":["1"],"_ListIterable.E":"1","core|_ListIterable":["1"],"EfficientLengthIterable.T":"1","_internal|EfficientLengthIterable":["1"],"HideEfficientLengthIterable.T":"1","_internal|HideEfficientLengthIterable":["1"]},"core|Iterable":{"Iterable.E":"1"},"core|_ListIterable":{"_ListIterable.E":"1","EfficientLengthIterable.T":"1","_internal|EfficientLengthIterable":["1"],"HideEfficientLengthIterable.T":"1","_internal|HideEfficientLengthIterable":["1"],"Iterable.E":"1","core|Iterable":["1"]},"_internal|EfficientLengthIterable":{"EfficientLengthIterable.T":"1","Iterable.E":"1","core|Iterable":["1"]},"_internal|HideEfficientLengthIterable":{"HideEfficientLengthIterable.T":"1","Iterable.E":"1","core|Iterable":["1"]},"core|int":{"core|num":[],"Comparable.T":"core|num","core|Comparable":["core|num"]},"core|num":{"Comparable.T":"core|num","core|Comparable":["core|num"]},"core|Comparable":{"Comparable.T":"1"},"core|String":{"Comparable.T":"core|String","core|Comparable":["core|String"],"core|Pattern":[]}}'));
  dart.trackLibraries("packages/leak_tracker/src/leak_tracking/helpers.dart", {
    "package:leak_tracker/src/leak_tracking/helpers.dart": helpers
  }, {
  }, '{"version":3,"sourceRoot":"","sources":["helpers.dart"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAyBY;QACN;AAFc;;AAIZ,sBAAY,AAAQ,OAAD,WAAW,0CAAQ;AAAa;;;AACnD,oBAAU;AAEV,oBAAqB;AAE3B,eAAK;AACK,QAAR,OAAO,OAAU,uBAAS,OAAO,QAAC,KAAM,CAAC;AACzC,YAAI,AAAQ,AAAO,OAAR,YAAU;AACX,UAAR,OAAO,YAAU;;;;AAIrB,aAAO,AAAoB,gCAAE,AAAQ,OAAD,GAAG,YAAY;AACjD,YAA0C,CAAlB,oBAAnB,SAAS,mBAAT,OAAW,iBAAX,kBAA+B,oCAAiB,UAAR,OAAO,EAAP,kBAAoB;AAC/D,qBAAM,+BAAiB,qBAAqB,OAAO;;AAErD,cAAM,yBAA8B;AACpC,sBAAc;;IAElB;;mEAUqD;AAAf;AACpC,UAAI,AAAI,AAAO,GAAR,iBAAiB,MAAO;AACzB,wBAAa,MAAM;AACnB,kBAAO,MAAM,8BACjB,UAAU,EACV,AAAI,GAAD;AAGL,UAAI,AAAK,IAAD,UAAU,MAAO;AACzB,YAAO,mCAAsB,IAAI;IACnC","file":"../../../../../../../../../packages/leak_tracker/src/leak_tracking/helpers.dart.lib.js"}');
  // Exports:
  return {
    src__leak_tracking__helpers: helpers
  };
}));

//# sourceMappingURL=helpers.dart.lib.js.map
