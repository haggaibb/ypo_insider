// Generated by DDC, the Dart Development Compiler (to JavaScript).
// Version: 3.3.1 (stable) (Wed Mar 6 13:09:19 2024 +0000) on "macos_arm64"
// Module: packages/leak_tracker/src/leak_tracking/_baseliner.dart
// Flags: newRuntimeTypes(true), soundNullSafety(true), enableAsserts(true)
define(['dart_sdk', 'packages/leak_tracker/src/leak_tracking/primitives/model.dart', 'packages/leak_tracker/src/leak_tracking/primitives/_print_bytes.dart'], (function load__packages__leak_tracker__src__leak_tracking___baseliner_dart(dart_sdk, packages__leak_tracker__src__leak_tracking__primitives__model$46dart, packages__leak_tracker__src__leak_tracking__primitives___print_bytes$46dart) {
  'use strict';
  const dart_rti = dart_sdk.dart_rti;
  const core = dart_sdk.core;
  const io = dart_sdk.io;
  const _interceptors = dart_sdk._interceptors;
  const dart = dart_sdk.dart;
  const dartx = dart_sdk.dartx;
  const model = packages__leak_tracker__src__leak_tracking__primitives__model$46dart.src__leak_tracking__primitives__model;
  const _print_bytes = packages__leak_tracker__src__leak_tracking__primitives___print_bytes$46dart.src__leak_tracking__primitives___print_bytes;
  var _baseliner = Object.create(dart.library);
  var $toStringAsFixed = dartx.toStringAsFixed;
  dart._checkModuleNullSafetyMode(true);
  dart._checkModuleRuntimeTypes(true);
  var T = {
    MemoryBaselining: () => (T.MemoryBaselining = dart.constFn(dart_rti.findType("leak_tracker__src__leak_tracking__primitives__model|MemoryBaselining")))(),
    MemoryBaseline: () => (T.MemoryBaseline = dart.constFn(dart_rti.findType("leak_tracker__src__leak_tracking__primitives__model|MemoryBaseline")))(),
    RecOfStringAndnumAndnum: () => (T.RecOfStringAndnumAndnum = dart.constFn(dart_rti.findType("+(core|String,core|num,core|num)")))(),
    numToString: () => (T.numToString = dart.constFn(dart_rti.findType("core|String(core|num)")))(),
    BaselinerNAndMemoryBaseliningNToBaselinerN: () => (T.BaselinerNAndMemoryBaseliningNToBaselinerN = dart.constFn(dart_rti.findType("leak_tracker__src__leak_tracking___baseliner|Baseliner?(leak_tracker__src__leak_tracking___baseliner|Baseliner?,leak_tracker__src__leak_tracking__primitives__model|MemoryBaselining?)")))(),
    VoidTovoid: () => (T.VoidTovoid = dart.constFn(dart_rti.findType("~()")))(),
    VoidToint: () => (T.VoidToint = dart.constFn(dart_rti.findType("core|int()")))(),
    VoidToString: () => (T.VoidToString = dart.constFn(dart_rti.findType("core|String()")))(),
    StringAndnumAndnumToString: () => (T.StringAndnumAndnumToString = dart.constFn(dart_rti.findType("core|String(core|String,core|num,core|num)")))(),
    ValueSampler: () => (T.ValueSampler = dart.constFn(dart_rti.findType("leak_tracker__src__leak_tracking__primitives__model|ValueSampler")))()
  };
  var G = {
    JSArrayOfRecOfStringAndnumAndnum: () => (G.JSArrayOfRecOfStringAndnumAndnum = dart.constFn(_interceptors.JSArray$(T.RecOfStringAndnumAndnum())))()
  };
  const CT = Object.create({
    _: () => (C, CT)
  });
  dart.defineLazy(CT, {
    get C0() {
      return C[0] = dart.const(Object.setPrototypeOf({
        [_Enum__name]: "measure",
        [_Enum_index]: 1
      }, model.BaseliningMode.prototype));
    },
    get C1() {
      return C[1] = dart.const(Object.setPrototypeOf({
        [_Enum__name]: "regression",
        [_Enum_index]: 2
      }, model.BaseliningMode.prototype));
    },
    get C2() {
      return C[2] = dart.const(Object.setPrototypeOf({
        [_Enum__name]: "none",
        [_Enum_index]: 0
      }, model.BaseliningMode.prototype));
    }
  }, false);
  var C = Array(3).fill(void 0);
  var I = [
    "file:///Users/haggaibarel/.pub-cache/hosted/pub.dev/leak_tracker-10.0.0/lib/src/leak_tracking/_baseliner.dart",
    "package:leak_tracker/src/leak_tracking/_baseliner.dart",
    "package:leak_tracker/src/leak_tracking/primitives/model.dart"
  ];
  var baselining$ = dart.privateName(_baseliner, "Baseliner.baselining");
  var rss = dart.privateName(_baseliner, "Baseliner.rss");
  var _finish = dart.privateName(_baseliner, "_finish");
  var _asComparison = dart.privateName(_baseliner, "_asComparison");
  var _Enum__name = dart.privateName(core, "_Enum._name");
  var _Enum_index = dart.privateName(core, "_Enum.index");
  var _asDelta = dart.privateName(_baseliner, "_asDelta");
  _baseliner.Baseliner = class Baseliner extends core.Object {
    get baselining() {
      return this[baselining$];
    }
    set baselining(value) {
      super.baselining = value;
    }
    get rss() {
      return this[rss];
    }
    set rss(value) {
      super.rss = value;
    }
    static ['_#_#tearOff'](baselining) {
      return new _baseliner.Baseliner.__(baselining);
    }
    static finishOldAndStartNew(oldBaseliner, baselining) {
      let t$360;
      t$360 = oldBaseliner;
      t$360 == null ? null : t$360[_finish]();
      if (baselining == null || baselining.mode === model.BaseliningMode.none) {
        return null;
      }
      return new _baseliner.Baseliner.__(baselining);
    }
    takeSample() {
      this.rss.add(_baseliner.Baseliner._currentRss());
    }
    [_finish]() {
      switch (this.baselining.mode) {
        case C[0] || CT.C0:
          {
            if (this.baselining.baseline != null) {
              core.print(dart.strSafe(dart.bind(this, _asComparison)) + "\n\n\n");
              core.print("\n\n");
            }
            core.print(this.asDartCode());
            break;
          }
        case C[1] || CT.C1:
          {
            dart.throw(new core.UnimplementedError.new("Regression testing for memory consumption is not implemented yet. Upvote the following issue if interested: https://github.com/dart-lang/leak_tracker/issues/120"));
          }
        case C[2] || CT.C2:
      }
    }
    static _currentRss() {
      return io.ProcessInfo.currentRss;
    }
    asDartCode() {
      return "To set as the new baseline, set the following parameter of " + dart.strSafe(dart_rti.createRuntimeType(T.MemoryBaselining())) + ":\n      baseline: " + dart.strSafe(dart_rti.createRuntimeType(T.MemoryBaseline())) + "(\n        rss: " + this.rss.asDartCode() + ",\n      )";
    }
    [_asComparison]() {
      let baseline = this.baselining.baseline;
      if (baseline == null) dart.throw(new core.StateError.new("Baseline is not set."));
      let golden = baseline.rss;
      let current = this.rss;
      let buffer = new core.StringBuffer.new();
      let byteEntries = G.JSArrayOfRecOfStringAndnumAndnum().of([dart.recordLiteral("3;", 3, void 0, ["initialValue", current.initialValue, golden.initialValue]), dart.recordLiteral("3;", 3, void 0, ["deltaAvg", current.deltaAvg, golden.deltaAvg]), dart.recordLiteral("3;", 3, void 0, ["deltaMax", current.deltaMax, golden.deltaMax]), dart.recordLiteral("3;", 3, void 0, ["absAvg", current.absAvg, golden.absAvg]), dart.recordLiteral("3;", 3, void 0, ["absMax", current.absMax, golden.absMax])]);
      for (let e of byteEntries) {
        let label = null;
        let current = null;
        let golden = null;
        {
          let t$36$350$350 = e;
          label = t$36$350$350.$1;
          current = t$36$350$350.$2;
          golden = t$36$350$350.$3;
        }
        buffer.writeln(this[_asDelta](label, current, golden));
      }
      buffer.writeln("samples: " + dart.strSafe(current.samples) + " - " + dart.strSafe(golden.samples) + " = " + dart.strSafe(current.samples - golden.samples));
      return dart.toString(buffer);
    }
    [_asDelta](name, current, golden) {
      function format(size) {
        let t$361;
        t$361 = _print_bytes.prettyPrintBytes(size, {includeUnit: true});
        return t$361 == null ? "" : t$361;
      }
      dart.fn(format, T.numToString());
      let delta = current - golden;
      let deltaPercent = (delta / golden * 100)[$toStringAsFixed](2);
      return name + ": " + format(current) + " - " + format(golden) + " = " + format(delta) + " (" + deltaPercent + "%)";
    }
  };
  (_baseliner.Baseliner.__ = function(baselining) {
    this[baselining$] = baselining;
    if (!(baselining.mode !== model.BaseliningMode.none)) dart.assertFailed(null, I[0], 14, 16, "baselining.mode != BaseliningMode.none");
    this[rss] = new model.ValueSampler.start({initialValue: _baseliner.Baseliner._currentRss()});
    ;
  }).prototype = _baseliner.Baseliner.prototype;
  dart.addTypeTests(_baseliner.Baseliner);
  dart.addRtiResources(_baseliner.Baseliner, ["leak_tracker__src__leak_tracking___baseliner|Baseliner"]);
  dart.addTypeCaches(_baseliner.Baseliner);
  dart.setMethodSignature(_baseliner.Baseliner, () => dart.global.Object.setPrototypeOf({
    takeSample: T.VoidTovoid(),
    [_finish]: T.VoidTovoid(),
    asDartCode: T.VoidToString(),
    [_asComparison]: T.VoidToString(),
    [_asDelta]: T.StringAndnumAndnumToString()
  }, dart.getMethods(dart.global.Object.getPrototypeOf(_baseliner.Baseliner))));
  dart.setStaticMethodSignature(_baseliner.Baseliner, () => ['finishOldAndStartNew', '_currentRss']);
  dart.setLibraryUri(_baseliner.Baseliner, I[1]);
  dart.setFieldSignature(_baseliner.Baseliner, () => dart.global.Object.setPrototypeOf({
    baselining: {type: T.MemoryBaselining(), isConst: false, isFinal: true, libraryUri: I[2]},
    rss: {type: T.ValueSampler(), isConst: false, isFinal: true, libraryUri: I[2]}
  }, dart.getFields(dart.global.Object.getPrototypeOf(_baseliner.Baseliner))));
  dart.moduleConstCaches.set("packages/leak_tracker/src/leak_tracking/_baseliner.dart", C);
  dart_rti._Universe.addRules(dart.typeUniverse, JSON.parse('{"core|String":{"Comparable.T":"core|String","core|Comparable":["core|String"],"core|Pattern":[]},"core|Comparable":{"Comparable.T":"1"},"core|num":{"Comparable.T":"core|num","core|Comparable":["core|num"]},"core|int":{"core|num":[],"Comparable.T":"core|num","core|Comparable":["core|num"]}}'));
  dart.trackLibraries("packages/leak_tracker/src/leak_tracking/_baseliner.dart", {
    "package:leak_tracker/src/leak_tracking/_baseliner.dart": _baseliner
  }, {
  }, '{"version":3,"sourceRoot":"","sources":["_baseliner.dart"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAgByB;;;;;;IACJ;;;;;;;;;gCAGN,cACO;;AAElB,0BAAY;sBAAZ,OAAc;AACd,UAAI,AAAW,UAAD,YAAY,AAAW,AAAK,UAAN,UAAwB;AAC1D,cAAO;;AAET,YAAiB,6BAAE,UAAU;IAC/B;;AAGM,MAAJ,aAAQ;IACV;;AAGE,cAAQ,AAAW;;;AAEf,gBAAI,AAAW;AACb,yBAA4B,uBAApB,wBAAa;AACrB,yBAAM;;AAER,uBAAM;;;;;AAEN,uBAAM;;;;IAKZ;;AAE4B,YAAY;IAAU;;AAGhD,YAAO,AAGD,kIAHgF,uFAC3D,qBAChB,AAAI,wBAAa;IAE9B;;AAGQ,qBAAW,AAAW;AAC5B,UAAI,AAAS,QAAD,UAAU,WAAM,wBAAW;AACjC,mBAAS,AAAS,QAAD;AACjB,oBAAU;AACV,mBAAS;AAET,wBAAc,yCAClB,qCAAC,gBAAgB,AAAQ,OAAD,eAAe,AAAO,MAAD,iBAC7C,qCAAC,YAAY,AAAQ,OAAD,WAAW,AAAO,MAAD,aACrC,qCAAC,YAAY,AAAQ,OAAD,WAAW,AAAO,MAAD,aACrC,qCAAC,UAAU,AAAQ,OAAD,SAAS,AAAO,MAAD,WACjC,qCAAC,UAAU,AAAQ,OAAD,SAAS,AAAO,MAAD;AAGnC,eAAW,IAAK,YAAW;AAClB;AAAO;AAAS;;AAAU,8BAAC;AAA3B;AAAO;AAAS;;AAChB,QAAP,MAAM,SAAS,eAAS,KAAK,EAAE,OAAO,EAAE,MAAM;;AAGzC,MAAP,MAAM,SAAQ,AACZ,2BAAY,AAAQ,OAAD,YAAS,qBAAK,AAAO,MAAD,YAAS,qBAC7C,AAAQ,AAAQ,OAAT,WAAW,AAAO,MAAD;AAE7B,YAAc,eAAP,MAAM;IACf;eAEuB,MAAU,SAAa;AAC5C,eAAO,OAAW;;AAAS,8CAAiB,IAAI,gBAAe;cAApC,iBAA6C;;;AAClE,kBAAQ,AAAQ,OAAD,GAAG,MAAM;AACxB,yBAAsC,CAAtB,AAAM,AAAS,KAAV,GAAG,MAAM,GAAG,uBAAqB;AAC5D,YAAS,KAAI,UAAI,MAAM,CAAC,OAAO,IAAE,QAAK,MAAM,CAAC,MAAM,IAAE,QAC9C,MAAM,CAAC,KAAK,IAAE,OAAG,YAAY;IACtC;;;IAhFiB;UACJ,AAAW,AAAK,UAAN,UAAwB;IACrC,YAAe,4CAAoB;;EAAc","file":"../../../../../../../../../packages/leak_tracker/src/leak_tracking/_baseliner.dart.lib.js"}');
  // Exports:
  return {
    src__leak_tracking___baseliner: _baseliner
  };
}));

//# sourceMappingURL=_baseliner.dart.lib.js.map
