// Generated by DDC, the Dart Development Compiler (to JavaScript).
// Version: 3.3.1 (stable) (Wed Mar 6 13:09:19 2024 +0000) on "macos_arm64"
// Module: packages/test_api/src/backend/stack_trace_formatter.dart
// Flags: newRuntimeTypes(true), soundNullSafety(true), enableAsserts(true)
define(['dart_sdk', 'packages/test_api/src/backend/declarer.dart', 'packages/stack_trace/src/stack_zone_specification.dart'], (function load__packages__test_api__src__backend__stack_trace_formatter_dart(dart_sdk, packages__test_api__src__backend__declarer$46dart, packages__stack_trace__src__stack_zone_specification$46dart) {
  'use strict';
  const dart_rti = dart_sdk.dart_rti;
  const core = dart_sdk.core;
  const collection = dart_sdk.collection;
  const async = dart_sdk.async;
  const _js_helper = dart_sdk._js_helper;
  const dart = dart_sdk.dart;
  const dartx = dart_sdk.dartx;
  const invoker = packages__test_api__src__backend__declarer$46dart.src__backend__invoker;
  const chain$ = packages__stack_trace__src__stack_zone_specification$46dart.src__chain;
  var stack_trace_formatter = Object.create(dart.library);
  var $isNotEmpty = dartx.isNotEmpty;
  dart._checkModuleNullSafetyMode(true);
  dart._checkModuleRuntimeTypes(true);
  var T = {
    String: () => (T.String = dart.constFn(dart_rti.findType("core|String")))(),
    StackTraceFormatterN: () => (T.StackTraceFormatterN = dart.constFn(dart_rti.findType("test_api__src__backend__stack_trace_formatter|StackTraceFormatter?")))(),
    ObjectN: () => (T.ObjectN = dart.constFn(dart_rti.findType("core|Object?")))(),
    FrameTobool: () => (T.FrameTobool = dart.constFn(dart_rti.findType("core|bool(stack_trace__src__frame|Frame)")))(),
    FnToT: () => (T.FnToT = dart.constFn(dart_rti.findType("0^(0^())<core|Object?>")))(),
    dynamic: () => (T.dynamic = dart.constFn(dart_rti.findType("@")))(),
    __Tovoid: () => (T.__Tovoid = dart.constFn(dart_rti.findType("~({except:core|Set<core|String>?,mapper:test_api__src__backend__stack_trace_mapper|StackTraceMapper?,only:core|Set<core|String>?})")))(),
    StackTrace__ToChain: () => (T.StackTrace__ToChain = dart.constFn(dart_rti.findType("stack_trace__src__chain|Chain(core|StackTrace{verbose:core|bool?})")))(),
    StackTraceMapperN: () => (T.StackTraceMapperN = dart.constFn(dart_rti.findType("test_api__src__backend__stack_trace_mapper|StackTraceMapper?")))(),
    SetOfString: () => (T.SetOfString = dart.constFn(dart_rti.findType("core|Set<core|String>")))()
  };
  var G = {
    LinkedHashSetOfString: () => (G.LinkedHashSetOfString = dart.constFn(collection.LinkedHashSet$(T.String())))(),
    LinkedMapOfObjectN$ObjectN: () => (G.LinkedMapOfObjectN$ObjectN = dart.constFn(_js_helper.LinkedMap$(T.ObjectN(), T.ObjectN())))()
  };
  const CT = Object.create({
    _: () => (C, CT)
  });
  var I = [
    "package:test_api/src/backend/stack_trace_formatter.dart",
    "package:test_api/src/backend/stack_trace_mapper.dart",
    "dart:core"
  ];
  var _mapper = dart.privateName(stack_trace_formatter, "_mapper");
  var _except = dart.privateName(stack_trace_formatter, "_except");
  var _only = dart.privateName(stack_trace_formatter, "_only");
  var _as = dart.privateName(dart_rti, "_as");
  stack_trace_formatter.StackTraceFormatter = class StackTraceFormatter extends core.Object {
    static get current() {
      return T.StackTraceFormatterN()[_as](async.Zone.current._get(stack_trace_formatter._currentKey));
    }
    asCurrent(T, body) {
      return async.runZoned(T, body, {zoneValues: new (G.LinkedMapOfObjectN$ObjectN()).from([stack_trace_formatter._currentKey, this])});
    }
    configure(opts) {
      let mapper = opts && 'mapper' in opts ? opts.mapper : null;
      let except = opts && 'except' in opts ? opts.except : null;
      let only = opts && 'only' in opts ? opts.only : null;
      if (mapper != null) this[_mapper] = mapper;
      if (except != null) this[_except] = except;
      if (only != null) this[_only] = only;
    }
    formatStackTrace(stackTrace, opts) {
      let t$360, t$360$, t$360$0, t$360$1;
      let verbose = opts && 'verbose' in opts ? opts.verbose : null;
      verbose == null ? verbose = (t$360$ = (t$360 = invoker.Invoker.current, t$360 == null ? null : t$360.liveTest.test.metadata.verboseTrace), t$360$ == null ? false : t$360$) : null;
      let chain = chain$.Chain.forTrace((t$360$1 = (t$360$0 = this[_mapper], t$360$0 == null ? null : t$360$0.mapStackTrace(stackTrace)), t$360$1 == null ? stackTrace : t$360$1));
      if (dart.test(verbose)) return chain;
      return chain.foldFrames(dart.fn(frame => {
        if (this[_only][$isNotEmpty]) return !this[_only].contains(frame.package);
        return this[_except].contains(frame.package);
      }, T.FrameTobool()), {terse: true});
    }
    static ['_#new#tearOff']() {
      return new stack_trace_formatter.StackTraceFormatter.new();
    }
  };
  (stack_trace_formatter.StackTraceFormatter.new = function() {
    this[_mapper] = null;
    this[_except] = G.LinkedHashSetOfString().from(["matcher", "stream_channel", "test", "test_api"]);
    this[_only] = G.LinkedHashSetOfString().new();
    ;
  }).prototype = stack_trace_formatter.StackTraceFormatter.prototype;
  dart.addTypeTests(stack_trace_formatter.StackTraceFormatter);
  dart.addRtiResources(stack_trace_formatter.StackTraceFormatter, ["test_api__src__backend__stack_trace_formatter|StackTraceFormatter"]);
  dart.addTypeCaches(stack_trace_formatter.StackTraceFormatter);
  dart.setMethodSignature(stack_trace_formatter.StackTraceFormatter, () => dart.global.Object.setPrototypeOf({
    asCurrent: T.FnToT(),
    configure: T.__Tovoid(),
    formatStackTrace: T.StackTrace__ToChain()
  }, dart.getMethods(dart.global.Object.getPrototypeOf(stack_trace_formatter.StackTraceFormatter))));
  dart.setMethodsDefaultTypeArgSignature(stack_trace_formatter.StackTraceFormatter, () => dart.global.Object.setPrototypeOf({asCurrent: [T.dynamic()]}, dart.getMethodsDefaultTypeArgs(dart.global.Object.getPrototypeOf(stack_trace_formatter.StackTraceFormatter))));
  dart.setStaticGetterSignature(stack_trace_formatter.StackTraceFormatter, () => ['current']);
  dart.setLibraryUri(stack_trace_formatter.StackTraceFormatter, I[0]);
  dart.setFieldSignature(stack_trace_formatter.StackTraceFormatter, () => dart.global.Object.setPrototypeOf({
    [_mapper]: {type: T.StackTraceMapperN(), isConst: false, isFinal: false, libraryUri: I[1]},
    [_except]: {type: T.SetOfString(), isConst: false, isFinal: false, libraryUri: I[2]},
    [_only]: {type: T.SetOfString(), isConst: false, isFinal: false, libraryUri: I[2]}
  }, dart.getFields(dart.global.Object.getPrototypeOf(stack_trace_formatter.StackTraceFormatter))));
  dart.defineLazy(stack_trace_formatter, {
    /*stack_trace_formatter._currentKey*/get _currentKey() {
      return new core.Object.new();
    }
  }, false);
  dart_rti._Universe.addRules(dart.typeUniverse, JSON.parse('{"core|String":{"Comparable.T":"core|String","core|Comparable":["core|String"],"core|Pattern":[]},"core|Comparable":{"Comparable.T":"1"},"core|Set":{"Set.E":"1","Iterable.E":"1","core|Iterable":["1"],"_SetIterable.E":"1","core|_SetIterable":["1"],"EfficientLengthIterable.T":"1","_internal|EfficientLengthIterable":["1"],"HideEfficientLengthIterable.T":"1","_internal|HideEfficientLengthIterable":["1"]},"core|Iterable":{"Iterable.E":"1"},"core|_SetIterable":{"_SetIterable.E":"1","EfficientLengthIterable.T":"1","_internal|EfficientLengthIterable":["1"],"HideEfficientLengthIterable.T":"1","_internal|HideEfficientLengthIterable":["1"],"Iterable.E":"1","core|Iterable":["1"]},"_internal|EfficientLengthIterable":{"EfficientLengthIterable.T":"1","Iterable.E":"1","core|Iterable":["1"]},"_internal|HideEfficientLengthIterable":{"HideEfficientLengthIterable.T":"1","Iterable.E":"1","core|Iterable":["1"]},"stack_trace__src__chain|Chain":{"core|StackTrace":[]}}'));
  dart.trackLibraries("packages/test_api/src/backend/stack_trace_formatter.dart", {
    "package:test_api/src/backend/stack_trace_formatter.dart": stack_trace_formatter
  }, {
  }, '{"version":3,"sourceRoot":"","sources":["stack_trace_formatter.dart"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCM,YAA0B,+BAArB,AAAO,wBAAC;IAAoC;iBAMzB;AACxB,+BAAS,IAAI,eAAc,2CAAC,mCAAa;IAAM;;UAS5B;UAAqB;UAAqB;AAC/D,UAAI,MAAM,UAAU,gBAAU,MAAM;AACpC,UAAI,MAAM,UAAU,gBAAU,MAAM;AACpC,UAAI,IAAI,UAAU,cAAQ,IAAI;IAChC;qBAQkC;;UAAmB;AAC3C,MAAR,OAAO,WAAP,WAAiE,2DAA7C,OAAS,AAAS,AAAK,AAAS,4CAAhC,iBAAgD,kBAA5D;AAEJ,kBACM,uBAA4C,sDAAnC,OAAS,sBAAc,UAAU,IAAjC,kBAAsC,UAAU;AACnE,oBAAI,OAAO,GAAE,MAAO,MAAK;AAEzB,YAAO,AAAM,MAAD,YAAY,QAAC;AACvB,YAAI,AAAM,0BAAY,QAAQ,AAAM,qBAAS,AAAM,KAAD;AAClD,cAAO,AAAQ,wBAAS,AAAM,KAAD;mCACrB;IACZ;;;;;;IAnDkB;IAGd,gBAAU,gCAAC,WAAW,kBAAkB,QAAQ;IAIhD,cAAgB;;EA6CtB;;;;;;;;;;;;;;;;;;MA9DM,iCAAW;YAAG","file":"../../../../../../../../../packages/test_api/src/backend/stack_trace_formatter.dart.lib.js"}');
  // Exports:
  return {
    src__backend__stack_trace_formatter: stack_trace_formatter
  };
}));

//# sourceMappingURL=stack_trace_formatter.dart.lib.js.map
